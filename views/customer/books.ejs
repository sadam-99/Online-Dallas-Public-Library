<%-include('../partials/header.html')%>
    <link rel="stylesheet" href="/../../css/customer.css">
    <title>Books</title>
    </head>

    <body>

        <%-include('partials/navbar.html')%>
            <div class="container-fluid">
                <div class="row">
                    <%-include('partials/sidebar.html')%>
                        <div class="col-md-10 content">
                            <form method="post">
                                <div class="input-group mb-5 search-bar">
                                    <div class="input-group-prepend">
                                        <label class="input-group-text" for="inputGroupSelect01">Search Books</label>
                                    </div>
                                    <select class="custom-select dropbar" id="inputGroupSelect01" name="searchBy">
                                            <option selected>By...</option>
                                            <option value="genre">Genre</option>
                                            <option value="title">Title</option>
                                            <option value="author">Author</option>
                                            <option value="publisher">Publisher</option>
                                            <option value="edition">Edition</option>
                                            <option value="isbn">ISBN</option>
                                            <option value="pages">Pages</option>
                                        </select>
                                    <div class="form-inline">

                                        <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="word">
                                        <button class="btn btn-outline-primary my-2 my-sm-0" type="submit">Search</button>
                                    </div>
                                </div>
                            </form>

                            <table class="table table-striped table-light table-hover">
                                <thead>
                                    <tr>
                                        <th scope="col">ID</th>
                                        <th scope="col">Genre</th>
                                        <th scope="col">Title</th>
                                        <th scope="col">Author</th>
                                        <th scope="col">Publisher</th>
                                        <th scope="col">Edition</th>
                                        <th scope="col">ISBN</th>
                                        <th scope="col">Pages</th>
                                        <!-- <th scope="col">Action</th> -->
                                    </tr>
                                </thead>
                                <tbody>
                                    <% for(var i=0; i< res.length; i++){ %>
                                        <% var BID = res[i].book_id %>
                                        <% var title = res[i].title %>
                                        <%=BID%>
                                        <%=title%>
                                        <tr>
                                            <th scope="row">
                                                <%=res[i].book_id%>
                                            </th>
                                            <td>
                                                <%=res[i].genre%>
                                            </td>
                                            <td>
                                                <%=res[i].title%>
                                            </td>
                                            <td>
                                                <%=res[i].author%>
                                            </td>
                                            <td>
                                                <%=res[i].publisher%>
                                            </td>
                                            <td>
                                                <%=res[i].edition%>
                                            </td>
                                            <td>
                                                <%=res[i].isbn%>
                                            </td>
                                            <td>
                                                <%=res[i].pages%>
                                                <!-- <input type="checkbox" class="form-control myRadioBtn" id ="radio" _ + ID<%=BID%>"" value = <%=BID%> name = <%=BID%> > -->
                                                <input type="checkbox" class="form-control" name ="check"  value=<%=BID%> >
                                            </td>
                                            
                                            <!-- <td>
                                                <% if(res[i].user_id) { %>
                                                    <a href="/admin/books/edit/<%=res[i].book_id%>">Request to Borrow Book</a> |
                                                    <a href="/admin/books/delete/<%=res[i].book_id%>">Delete Book</a>
                                                <% } else { %>
                                                    <a href="/admin/books/<%=res[i].book_id%>/issue">Issue Book</a> |
                                                    <a href="/admin/books/edit/<%=res[i].book_id%>">Edit Book</a> |
                                                    <a href="/admin/books/delete/<%=res[i].book_id%>">Delete Book</a>
                                                <% } %>
                                            </td> -->
                                        </tr>
                                        <% } %>
                                        

                                </tbody>
                            </table>
                            <button type="button" id="myButton" class="float-left submit-button" >Borrow Selected Books!</button>
                            <!-- <button type="button">Borrow Selected Books!</button> -->
                            <!-- <button onclick="location.href = 'books/borrowed';" id="myButton" class="float-left submit-button" >Borrow Selected Books!</button> -->
                            <!-- <button onclick="myFunction()" id="myButton" class="float-left submit-button" >Borrow Selected Books!</button> -->
                        </div>
                        <!-- console.log($('#opt1').val()) -->
                </div>
            </div>
                <p id = "borrow_message">    </p>
                <!-- FUNCTION 0N ONCLICK -->
                <!-- <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script> -->
                <script
                src="https://code.jquery.com/jquery-3.5.0.js"
                integrity="sha256-r/AaFHrszJtwpe+tHyNi/XCfMxYpbsRg2Uqn0x3s2zc="
                crossorigin="anonymous"></script>
                <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
                <script type="text/javascript" src = "../../controllers/customer.js"></script>
                <script>
                    $(document).ready(function() {
                        $("button").click(function(){
                            var bookIDs = [];
                            $.each($("input[name='check']:checked"), function(){            
                                bookIDs.push($(this).val());
                            });
                            document.getElementById("borrow_message").innerHTML = "Your Selected Books have been Borrowed, check your Borrowed History"
                            alert("My Book IDs are: " + bookIDs.join(","));
                            console.log("bookIds, ", bookIDs);

                            // $.post("http://127.0.0.1:3000/customer/books",{obj},
                            // function( data, status ){
                            //     alert("Data: " + data + "\nStatus: " + status);
                            // });

                            // $.ajax({
                            // type: 'POST',
                            // url: "http://127.0.0.1:3000/customer/books",
                            // data: JSON.stringify({
                            //     "booksId": bookIDs}),
                            // success: function (result) {
                            //     console.log(result)
                            // },
                            // error: function(e) {
                            //     console.log(e);
                            // },
                            // dataType: "json",
                            // contentType: "application/json"
                            // });

                            var xhr = new XMLHttpRequest();
                            // Asynchronous call
                            xhr.open("POST", "http://127.0.0.1:3000/customer/books", false);
                            xhr.setRequestHeader("Content-Type", "application/json");
                            console.log("before send, ", bookIDs);
                            xhr.send(JSON.stringify({"booksId": bookIDs}));

                            
                            console.log("after send");

                            xhr.onreadystatechange = function() {
                                // It might take 4-5 sec to ex
                                if (this.readyState == 4 && this.status == 200) {
                                    
                                    console.log("response is: ", this.responseText);

                                } else {
                                    // Failure server
                                }
                            };

                            // mainjsfunction(bookIDs);
                            // Your Selected Books have been Borrowed, check your Borrowed History
                            // console.log(bookIDs)
                        });
                    });
                    // console.log(bookIDs)
                //   console.log(bookIDs);
                </script>
                <!-- <form action="/controllers/customer.js" method="POST">
                    <div>
                      <input name="Book_IDs" id="Book_IDs" value=bookIDs>
                      <input type="submit" value="Borrowbooks">
                    </div>
                  </form> -->
                  <!-- http://127.0.0.1:3000/customer/books -->
                <!-- <?php
                if ($_SERVER["REQUEST_METHOD"] == "POST") {
                    // collect value of input field
                    $name = $_POST['fname'];
                    if (empty($name)) {
                        echo "Name is empty";
                    } else {
                        echo $name;
                    }
                }
                ?> -->

                  <!-- <script type="text/javascript" src = "../../controllers/customer.js"mainjsfunction></script>
                  <script>
                    $(document).ready(function () {
                        $(".myButton").on("click", function () {
                            var value = $(".inputField").val();
                            mainjsfunction(value);
                        });
                    });
                </script> -->
                   <!-- console.log("fskn") -->
                  <!-- console.log($_POST['Book_IDs']); -->
            
            <%-include('../partials/footer.html')%>


        































            <!-- funtion GOTOTHE_PAGE() {
                var buttons = $(".myRadioBtn")
                if (document.getElementById("buttpn"+ i).checked==true) {


                }

                "location.href = 'books/borrowed'
            }
            if ($('#check_id').is(":checked"))
                {
                // it is checked
                } -->